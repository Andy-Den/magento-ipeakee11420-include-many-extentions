function checkEnterKeyEvent(e, recommend){     var characterCode;    if(e && e.which){        e = e        characterCode = e.which     } else {        characterCode = e.keyCode     }    if(navigator.userAgent.indexOf('Safari')!=-1 && characterCode == 3) {        productAddToCartForm.submit(recommend);        return false;    }    if(characterCode == 13){        productAddToCartForm.submit(recommend);        return false;    }    return true;}var Addtocart = Class.create();Addtocart.prototype = {    initialize: function(form, getPostUrl){            this.form = form;        this.getPostUrl = getPostUrl;        this.getUrl = '';        this.onComplete = this.resetLoadWaiting.bindAsEventListener(this);        this.containerSuffix = '';        this.x = '';        this.messages = '';        this.y = '';        this.onRequestComplete = this.resetRequestLoadWaiting.bindAsEventListener(this);    },    _disableEnableAll: function(element, isDisabled) {        var descendants = element.descendants();        for (var k in descendants) {            descendants[k].disabled = isDisabled;        }        element.disabled = isDisabled;        jQuery('.btn-cart').prop('disabled', isDisabled);    },        resetRequestLoadWaiting: function(transport){        this.setRequestLoadWaiting(false);        if(this.messages != ''){            $('messages').innerHTML = this.messages;            this.messages = '';        }else{            var result = eval('(' + transport.responseText + ')');            this.messages = result.cart.message_block;                this.getResponseUrl(result.cart.response_url);            Enterprise.TopCart.initialize('topCartContent');        }    },    resetLoadWaiting: function(transport){        this.setLoadWaiting(false);        this.setDefaultConfigOptions();    },    setLoadWaiting: function(enable) {        if (enable) {            if (jQuery('#add-to'+this.containerSuffix).lenght>0) {                var container = $('add-to'+this.containerSuffix);                container.setStyle({opacity:.9});                this._disableEnableAll(container, true);            } else {                jQuery('.btn-cart').prop('disabled', true);            }            Element.show('loading-mask-cart'+this.containerSuffix);        }        else {            if (jQuery('#add-to'+this.containerSuffix).lenght>0) {                var container = $('add-to' + this.containerSuffix);                container.setStyle({opacity: 1});                this._disableEnableAll(container, false);            } else {                jQuery('.btn-cart').prop('disabled', false);            }            Element.hide('loading-mask-cart'+this.containerSuffix);            $('popup-added').style.left = this.x;            $('popup-added').style.top  = this.y;            Enterprise.TopCart.initialize('topCartContent');        }    },    getAddtocart: function(){        this.containerSuffix = '';        this.setLoadWaiting(true);        var currentForm = this.form;        var request = new Ajax.Request(             this.getPostUrl,            {                method: 'post',                evalJS: 'force',                onComplete: this.onComplete,                onFailure: function(response){                    alert('An error occurred while processing your request');                    this.onComplete;                },                onSuccess: function(response){                     if (response && response.responseText){                        try{                            cartValues = eval('(' + response.responseText + ')');                        }                        catch (e) {                            cartValues = {};                        }                    }                    var responseJson = JSON.parse(response.responseText);                    if(responseJson.update){                        alert(responseJson.message);                        return;                    }                    var ie8 = (navigator.appVersion.indexOf('MSIE 8.')!=-1) ? true : false;                    var mac = (navigator.appVersion.indexOf('Mac')!=-1) ? true : false;                    var safari = (navigator.userAgent.indexOf('Safari')!=-1) ? true : false;                    var firefox = (navigator.userAgent.indexOf('Firefox')!=-1) ? true : false;                    var opera = (navigator.userAgent.indexOf('Opera')!=-1) ? true : false;                                        isSuccess = /was successfully added to your shopping cart.$/.test(cartValues.cart.message);                    if(isSuccess) {                        if (cartValues.cart.return_url != '') {                            window.location.href = cartValues.cart.return_url;                            return false;                        }                        var items = 'items';                        var popup_url = jQuery('#'+ currentForm + ' .popup_url').val();                        if(cartValues.cart.items == 1) {items = 'item';}                        $('top-cart').innerHTML= cartValues.cart.items;                        rwd.skipLinks('#top-cart');                        if (cartValues.cart.custom_options == '') {                            cartValues.cart.custom_options = '1YR Warranty';                        }                        jQuery('#popupMiddleContainer').load(popup_url, {'qty':cartValues.cart.qty, 'price': cartValues.cart.price, 'options': cartValues.cart.custom_options, giftcard: cartValues.cart.custom_giftcard_amount, giftcard_amount: cartValues.cart.giftcard_amount}, function() {                           centerPopup('product-view-cart_popup');                            if(jQuery('#'+ currentForm + ' .popup_top_position').val() == '0px') {                                popupTop = parseInt($('product-view-cart_popup').getStyle('top'));                                if (popupTop < 0) {                                    popupTop = 0;                                }                                jQuery('#'+ currentForm + ' .popup_top_position').val(popupTop + 'px');                                $('product-view-cart_popup').setStyle({top : popupTop + 'px'});                            } else if($('product-view-cart_popup').getStyle('top') != jQuery('#'+ currentForm + ' .popup_top_position').val()) {                                $('product-view-cart_popup').setStyle({top : jQuery('#'+ currentForm + ' .popup_top_position').val()});                            }                            try {                                jQuery.fancybox.close();                            } catch (err){                                alert('There has been an error when processing your request!')                            }                            jQuery("select:not(.super-attribute-select), input[type='checkbox'], input[type='radio']").uniform({selectAutoWidth: false});                            loadPopup();                            jQuery('html, body').animate({                                scrollTop: jQuery('#product-view-cart_popup').offset().top                            }, 1000);                        });                        Enterprise.TopCart.initialize('topCartContent');                        $('sidebar-cart').innerHTML= cartValues.cart.sidebar_items;                        init('header', 3);                        init('sidebar', 4);                        updatePriceHtml();                    }                    else{                        jQuery('#popupMiddleContainer').html(                            '<div class="form-subscribe product-view-cart_popup" id="product-view-cart_popup">'                                +'<div class="mass-overlay" onclick="closePopup();"></div>'                                +'<div class="container">'                                    +'<a id="popupClose" onclick="javascript:closePopup();">x</a>'                                    +'<div class="view-cart-popup">'                                        +'<div class="cart_popup" id="cart_popup">'                                            + '<ul class="messages"><li class="err-msg"><ul><li><span>'+cartValues.cart.message+'</span></li></ul></li></ul>'                                        +'</div>'                                    +'</div>'                                +'</div>'                            +'</div>');                        centerPopup('product-view-cart_popup');                        if(jQuery('#'+ currentForm + ' .popup_top_position').val() == '0px') {                            popupTop = parseInt($('product-view-cart_popup').getStyle('top'));                            if (popupTop < 0) {                                popupTop = 0;                            }                            jQuery('#'+ currentForm + ' .popup_top_position').val(popupTop + 'px');                            $('product-view-cart_popup').setStyle({top : popupTop + 'px'});                        } else if($('product-view-cart_popup').getStyle('top') != jQuery('#'+ currentForm + ' .popup_top_position').val()) {                            $('product-view-cart_popup').setStyle({top : jQuery('#'+ currentForm + ' .popup_top_position').val()});                        }                        loadPopup();                        /*jQuery.fancybox({                            content: '<a onclick="javascript:closePopup();" id="popupClose">x</a><h2>Hello Fancybox</h2>',                            modal: true                        });*/                    }                },                parameters: jQuery('#'+this.form).serialize()            }        );    },        getUpsellAddtocart: function(url, id){        this.containerSuffix = "-upsell";        this.setLoadWaiting(true);        var request = new Ajax.Request(            url,            {                method: 'post',                evalJS: 'force',                onComplete: this.onComplete,                onFailure: function(response){                    alert('An error occurred while processing your request');                    this.onComplete;                },                onSuccess: function(response){                     if (response && response.responseText){                        try{                            cartValues = eval('(' + response.responseText + ')');                        }                        catch (e) {                            cartValues = {};                        }                    }                    var ie8 = (navigator.appVersion.indexOf('MSIE 8.')!=-1) ? true : false;                    var mac = (navigator.appVersion.indexOf('Mac')!=-1) ? true : false;                    var safari = (navigator.userAgent.indexOf('Safari')!=-1) ? true : false;                    var firefox = (navigator.userAgent.indexOf('Firefox')!=-1) ? true : false;                    var opera = (navigator.userAgent.indexOf('Opera')!=-1) ? true : false;                    isSuccess = /was successfully added to your shopping cart.$/.test(cartValues.cart.message);                    if(isSuccess) {                        if (cartValues.cart.return_url != '') {                            window.location.href = cartValues.cart.return_url;                            return false;                        }                        var items = 'items';                        var popup_url = BASE_URL + 'catalog/product/showpopup/id/' + id;                        if(cartValues.cart.items == 1) {items = 'item';}                        $('top-cart').innerHTML= cartValues.cart.items;                        rwd.skipLinks('#top-cart');                        jQuery('#popupMiddleContainer').load(popup_url, {'qty':cartValues.cart.qty, 'price': cartValues.cart.price, 'options': '1YR Warranty'}, function() {                            //centering with css                            centerPopup('product-view-cart_popup');                            jQuery("select:not(.super-attribute-select), input[type='checkbox'], input[type='radio']").uniform({selectAutoWidth: false});                            loadPopup();                        });                        Enterprise.TopCart.initialize('topCartContent');                        $('sidebar-cart').innerHTML= cartValues.cart.sidebar_items;                        init('header', 3);                        init('sidebar', 4);                        updatePriceHtml();                    }                    else{                    }                },                parameters: "product=" + id + "&qty=" + $F('qty_' + id) + "&option-price=0" +"&related_product="            }        );    },        showPopup: function(url){        try{            showPopup(url);                }catch(e){            alert(e.message);        }    }}