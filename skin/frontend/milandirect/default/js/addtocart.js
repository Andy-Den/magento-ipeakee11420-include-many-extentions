function checkEnterKeyEvent(e, recommend){     var characterCode;    if(e && e.which){        e = e        characterCode = e.which     } else {        characterCode = e.keyCode     }    if(navigator.userAgent.indexOf('Safari')!=-1 && characterCode == 3) {        productAddToCartForm.submit(recommend);        return false;    }    if(characterCode == 13){        productAddToCartForm.submit(recommend);        return false;    }    return true;}var Addtocart = Class.create();Addtocart.prototype = {    initialize: function(form, getPostUrl){            this.form = form;        this.getPostUrl = getPostUrl;        this.getUrl = '';        this.onComplete = this.resetLoadWaiting.bindAsEventListener(this);        this.containerSuffix = '';        this.x = '';        this.messages = '';        this.y = '';        this.onRequestComplete = this.resetRequestLoadWaiting.bindAsEventListener(this);    },    _disableEnableAll: function(element, isDisabled) {        var descendants = element.descendants();        for (var k in descendants) {            descendants[k].disabled = isDisabled;        }        element.disabled = isDisabled;    },        resetRequestLoadWaiting: function(transport){        this.setRequestLoadWaiting(false);        if(this.messages != ''){            $('messages').innerHTML = this.messages;            this.messages = '';        }else{            var result = eval('(' + transport.responseText + ')');            this.messages = result.cart.message_block;                this.getResponseUrl(result.cart.response_url);            Enterprise.TopCart.initialize('topCartContent');        }    },    resetLoadWaiting: function(transport){        this.setLoadWaiting(false);        this.setDefaultConfigOptions();    },    setLoadWaiting: function(enable) {        if (enable) {            var container = $('add-to'+this.containerSuffix);            container.setStyle({opacity:.9});            this._disableEnableAll(container, true);            Element.show('loading-mask-cart'+this.containerSuffix);        }        else {            var container = $('add-to'+this.containerSuffix);            container.setStyle({opacity:1});            this._disableEnableAll(container, false);            Element.hide('loading-mask-cart'+this.containerSuffix);            $('popup-added').style.left = this.x;            $('popup-added').style.top  = this.y;            Enterprise.TopCart.initialize('topCartContent');        }    },    getAddtocart: function(){        this.containerSuffix = '';        this.setLoadWaiting(true);        var request = new Ajax.Request(             this.getPostUrl,            {                method: 'post',                evalJS: 'force',                onComplete: this.onComplete,                onFailure: function(response){                    alert('An error occurred while processing your request');                    this.onComplete;                },                onSuccess: function(response){                     if (response && response.responseText){                        try{                            cartValues = eval('(' + response.responseText + ')');                        }                        catch (e) {                            cartValues = {};                        }                    }                    var ie8 = (navigator.appVersion.indexOf('MSIE 8.')!=-1) ? true : false;                    var mac = (navigator.appVersion.indexOf('Mac')!=-1) ? true : false;                    var safari = (navigator.userAgent.indexOf('Safari')!=-1) ? true : false;                    var firefox = (navigator.userAgent.indexOf('Firefox')!=-1) ? true : false;                    var opera = (navigator.userAgent.indexOf('Opera')!=-1) ? true : false;                                        isSuccess = /was successfully added to your shopping cart.$/.test(cartValues.cart.message);                    if(isSuccess) {                        var items = 'items';                        var popup_url = $F('popup_url');                        if(cartValues.cart.items == 1) {items = 'item';}                        $('top-cart').innerHTML= cartValues.cart.items;                                                jQuery('#popupMiddleContainer').load(popup_url, {'qty':cartValues.cart.qty, 'price': cartValues.cart.price, 'options': cartValues.cart.custom_options, giftcard: cartValues.cart.custom_giftcard_amount, giftcard_amount: cartValues.cart.giftcard_amount}, function() {                           centerPopup('product-view-cart_popup');                                                      if($('popup_top_position').value == '0px') {                        	   $('popup_top_position').value = $('product-view-cart_popup').getStyle('top');                           } else if($('product-view-cart_popup').getStyle('top') != $('popup_top_position').value) {                        	   $('product-view-cart_popup').setStyle({top : $('popup_top_position').value});                           }                                                      loadPopup();                        });                         Enterprise.TopCart.initialize('topCartContent');                        $('sidebar-cart').innerHTML= cartValues.cart.sidebar_items;                        init('header', 3);                        init('sidebar', 4);                        updatePriceHtml();                    }                    else{                    }                },                parameters: jQuery('#product_addtocart_form').serialize()            }        );    },        getUpsellAddtocart: function(url, id){        this.containerSuffix = "-upsell";        this.setLoadWaiting(true);        var request = new Ajax.Request(            url,            {                method: 'post',                evalJS: 'force',                onComplete: this.onComplete,                onFailure: function(response){                    alert('An error occurred while processing your request');                    this.onComplete;                },                onSuccess: function(response){                     if (response && response.responseText){                        try{                            cartValues = eval('(' + response.responseText + ')');                        }                        catch (e) {                            cartValues = {};                        }                    }                    var ie8 = (navigator.appVersion.indexOf('MSIE 8.')!=-1) ? true : false;                    var mac = (navigator.appVersion.indexOf('Mac')!=-1) ? true : false;                    var safari = (navigator.userAgent.indexOf('Safari')!=-1) ? true : false;                    var firefox = (navigator.userAgent.indexOf('Firefox')!=-1) ? true : false;                    var opera = (navigator.userAgent.indexOf('Opera')!=-1) ? true : false;                                        isSuccess = /was successfully added to your shopping cart.$/.test(cartValues.cart.message);                    if(isSuccess) {                        var items = 'items';                        var popup_url = BASE_URL + 'catalog/product/showpopup/id/' + id;                                                if(cartValues.cart.items == 1) {items = 'item';}                        $('top-cart').innerHTML= cartValues.cart.items;                        jQuery('#popupMiddleContainer').load(popup_url, {'qty':cartValues.cart.qty, 'price': cartValues.cart.price, 'options': '1YR Warranty'}, function() {                            //centering with css                            centerPopup('product-view-cart_popup');                                                    });                                                 Enterprise.TopCart.initialize('topCartContent');                        $('sidebar-cart').innerHTML= cartValues.cart.sidebar_items;                        init('header', 3);                        init('sidebar', 4);                        updatePriceHtml();                    }                    else{                    }                },                parameters: "product=" + id + "&qty=" + $F('qty_' + id) + "&option-price=0" +"&related_product="            }        );    },        showPopup: function(url){        try{            showPopup(url);                }catch(e){            alert(e.message);        }    }}